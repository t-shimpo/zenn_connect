---
title: "LeetCode 703. Kth Largest Element in a Stream (Python3)"
emoji: "ğŸ–‹"
type: "tech" # tech: æŠ€è¡“è¨˜äº‹ / idea: ã‚¢ã‚¤ãƒ‡ã‚¢
topics: ["leetcode", "python"]
published: true
---
## ã¯ã˜ã‚ã«
LeetCode ã€Œ703. Kth Largest Element in a Streamã€ã®å•é¡Œã‚’ **Python3** ã§è§£ãã¾ã—ãŸã€‚

## å•é¡Œ
https://leetcode.com/problems/kth-largest-element-in-a-stream/description/

### å•é¡Œæ–‡
You are part of a university admissions office and need to keep track of the `kth` highest test score from applicants in real-time. This helps to determine cut-off marks for interviews and admissions dynamically as new applicants submit their scores.

You are tasked to implement a class which, for a given integer k, maintains a stream of test scores and continuously returns the `kth` highest test score after a new score has been submitted. More specifically, we are looking for the `kth` highest score in the sorted list of all scores.

Implement the `KthLargest` class:

`KthLargest(int k, int[] nums)` Initializes the object with the integer k and the stream of test scores nums.
`int add(int val)` Adds a new test score val to the stream and returns the element representing the `kth` largest element in the pool of test scores so far.

**å’Œè¨³**
ã‚ãªãŸã¯å¤§å­¦ã®å…¥å­¦äº‹å‹™å±€ã®ä¸€å“¡ã§ã‚ã‚Šã€å¿—é¡˜è€…ã‹ã‚‰æå‡ºã•ã‚Œã‚‹ãƒ†ã‚¹ãƒˆã‚¹ã‚³ã‚¢ã®ã†ã¡ã€ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ã§kç•ªç›®ã«é«˜ã„ã‚¹ã‚³ã‚¢ã‚’è¿½è·¡ã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚ã“ã‚Œã«ã‚ˆã‚Šã€æ–°ãŸãªå¿—é¡˜è€…ãŒã‚¹ã‚³ã‚¢ã‚’æå‡ºã™ã‚‹ãŸã³ã«ã€é¢æ¥ã‚„å…¥å­¦ã®åˆæ ¼åŸºæº–ç‚¹ã‚’å‹•çš„ã«æ±ºå®šã™ã‚‹ã“ã¨ãŒå¯èƒ½ã«ãªã‚Šã¾ã™ã€‚

ä¸ãˆã‚‰ã‚ŒãŸæ•´æ•° k ã«å¯¾ã—ã¦ã€è©¦é¨“ã‚¹ã‚³ã‚¢ã®ã‚¹ãƒˆãƒªãƒ¼ãƒ ã‚’ç¶­æŒã—ã€æ–°ã—ã„ã‚¹ã‚³ã‚¢ãŒæå‡ºã•ã‚ŒãŸå¾Œã« k ç•ªç›®ã«é«˜ã„ã‚¹ã‚³ã‚¢ã‚’ç¶™ç¶šçš„ã«è¿”ã™ã‚¯ãƒ©ã‚¹ã‚’å®Ÿè£…ã™ã‚‹ä»»å‹™ãŒä¸ãˆã‚‰ã‚Œã¦ã„ã¾ã™ã€‚å…·ä½“çš„ã«ã¯ã€å…¨ã‚¹ã‚³ã‚¢ã®ã‚½ãƒ¼ãƒˆæ¸ˆã¿ãƒªã‚¹ãƒˆã«ãŠã‘ã‚‹ k ç•ªç›®ã«é«˜ã„ã‚¹ã‚³ã‚¢ã‚’æ±‚ã‚ã¦ã„ã¾ã™ã€‚

`KthLargest`ã‚¯ãƒ©ã‚¹ã®å®Ÿè£…:

`KthLargest(int k, int[] nums)`
æ•´æ•°kã¨ãƒ†ã‚¹ãƒˆã‚¹ã‚³ã‚¢ã®ã‚¹ãƒˆãƒªãƒ¼ãƒ numsã§ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚’åˆæœŸåŒ–ã—ã¾ã™ã€‚
`int add(int val)`
æ–°ã—ã„ãƒ†ã‚¹ãƒˆã‚¹ã‚³ã‚¢valã‚’ã‚¹ãƒˆãƒªãƒ¼ãƒ ã«è¿½åŠ ã—ã€ã“ã‚Œã¾ã§ã®ãƒ†ã‚¹ãƒˆã‚¹ã‚³ã‚¢ãƒ—ãƒ¼ãƒ«ã«ãŠã‘ã‚‹kç•ªç›®ã«å¤§ãã„è¦ç´ ã‚’è¡¨ã™è¦ç´ ã‚’è¿”ã—ã¾ã™ã€‚

### ä¾‹
1.
```
Input:
["KthLargest", "add", "add", "add", "add", "add"]
[[3, [4, 5, 8, 2]], [3], [5], [10], [9], [4]]

Output: [null, 4, 5, 5, 8, 8]

Explanation:

KthLargest kthLargest = new KthLargest(3, [4, 5, 8, 2]);
kthLargest.add(3); // return 4
kthLargest.add(5); // return 5
kthLargest.add(10); // return 5
kthLargest.add(9); // return 8
kthLargest.add(4); // return 8
```

2.
```
Input:
["KthLargest", "add", "add", "add", "add"]
[[4, [7, 7, 7, 7, 8, 3]], [2], [10], [9], [9]]

Output: [null, 7, 7, 7, 8]

Explanation:

KthLargest kthLargest = new KthLargest(4, [7, 7, 7, 7, 8, 3]);
kthLargest.add(2); // return 7
kthLargest.add(10); // return 7
kthLargest.add(9); // return 7
kthLargest.add(9); // return 8
```

### åˆ¶ç´„
- 0 <= nums.length <= 10â´
- 1 <= k <= nums.length + 1
- -10â´ <= nums[i] <= 10â´
- -10â´ <= val <= 10â´
- At most 10â´ calls will be made to add.

## è§£ç­”1ï¼ˆbisect.insortï¼‰
addé–¢æ•°ã§ãƒªã‚¹ãƒˆã«ãƒ‡ãƒ¼ã‚¿ã‚’æŒ¿å…¥ã—ã€ãã®ä¸Šã§kç•ªç›®ã«å¤§ãã„å€¤ã‚’è¿”ã—ã¾ã™ã€‚
ã¾ãšã¯ã‚ã‹ã‚Šã‚„ã™ã„æ–¹æ³•ã¨ã—ã¦ã€ã‚½ãƒ¼ãƒˆæ¸ˆã¿ã®ãƒªã‚¹ãƒˆã‚’ä¿æŒã—ã¦ã€ãã“ã«è¦ç´ ã‚’æŒ¿å…¥ã—ã¾ã™ã€‚
è§£ç­”2ã‚ˆã‚Šã‚‚åŠ¹ç‡ã¯æ‚ªã„ã§ã™ã€‚

`bisect.insort()`ã‚’ä½¿ç”¨ã—ã¾ã™ã€‚
[bisectãƒ©ã‚¤ãƒ–ãƒ©ãƒª](https://docs.python.org/ja/3.13/library/bisect.html)ã¯ã€ã‚½ãƒ¼ãƒˆæ¸ˆã¿ã®ãƒªã‚¹ãƒˆã‚’ä¿ã£ãŸã¾ã¾æ–°ã—ã„è¦ç´ ã‚’æŒ¿å…¥ã™ã‚‹ãŸã‚ã®æ©Ÿèƒ½ã‚’æä¾›ã—ã¦ã„ã¾ã™ã€‚
æŒ¿å…¥ä½ç½®ã‚’äºŒåˆ†æ¢ç´¢ã§è¦‹ã¤ã‘ã¾ã™ã€‚

### ã‚³ãƒ¼ãƒ‰1
```py
class KthLargest:

    def __init__(self, k: int, nums: List[int]):
        self.k = k
        self.nums = sorted(nums)

    def add(self, val: int) -> int:
        bisect.insort(self.nums, val)
        return self.nums[-(self.k)]
```

### è¨ˆç®—é‡
- æ™‚é–“çš„è¨ˆç®—é‡ï¼šè¦ç´ è¿½åŠ ã”ã¨O(n)
    - æŒ¿å…¥ã«ã‹ã‹ã‚‹ã‚·ãƒ•ãƒˆï¼‹ä¿æŒã™ã‚‹è¦ç´ æ•°åˆ†
- ç©ºé–“çš„è¨ˆç®—é‡ï¼šO(n)
    - å…¨ã¦ã®è¦ç´ ã‚’ä¿æŒ

### ã‚³ãƒ¼ãƒ‰2

ä¸Šè¨˜ã®ã‚³ãƒ¼ãƒ‰ã¯è¦ç´ ã‚’å…¨ã¦ä¿æŒã—ã¦ã„ã¾ã—ãŸãŒã€**kç•ªç›®ã«å¤§ãã„è¦ç´ **ã‚’æ±‚ã‚ãŸã„ã®ã§ã€kå€‹ã®å¤§ãã„è¦ç´ ã ã‘ã‚’ã‚½ãƒ¼ãƒˆã—ã¦ä¿æŒã™ã‚‹æ–¹æ³•ã‚’å–ã‚‹ã“ã¨ã‚‚ã§ãã¾ã™ã€‚
ãã†ã™ã‚‹ã¨ã€ãƒªã‚¹ãƒˆã®æœ€å°å€¤ãŒã¡ã‚‡ã†ã©**kç•ªç›®ã«å¤§ãã„è¦ç´ **ã¨ãªã‚Šã¾ã™ã€‚

```py
class KthLargest:
    def __init__(self, k: int, nums: List[int]):
        self.k = k
        self.nums = sorted(nums)[-k:]

    def add(self, val: int) -> int:
        if len(self.nums) < self.k:
            bisect.insort(self.nums, val)
        elif val > self.nums[0]:
            bisect.insort(self.nums, val)
            self.nums.pop(0)
        return self.nums[0]
```

### è¨ˆç®—é‡
- æ™‚é–“çš„è¨ˆç®—é‡ï¼šè¦ç´ è¿½åŠ ã”ã¨O(k)
    - æŒ¿å…¥ã«ã‹ã‹ã‚‹ã‚·ãƒ•ãƒˆï¼‹ä¿æŒã™ã‚‹è¦ç´ æ•°åˆ†
- ç©ºé–“çš„è¨ˆç®—é‡ï¼šO(k)
    - kå€‹ã®è¦ç´ ã ã‘ä¿æŒ

## è§£ç­”2ï¼ˆheapï¼‰
æ¬¡ã¯heapã‚’ä½¿ã£ãŸã‚ˆã‚ŠåŠ¹ç‡ã®è‰¯ã„æ–¹æ³•ã§ã™ã€‚
heap(ãƒ’ãƒ¼ãƒ—)ã¯ã€ãƒ‡ãƒ¼ã‚¿æ§‹é€ ã®ä¸€ç¨®ã§ã€æœ¨æ§‹é€ ã®ã†ã¡è¦ªè¦ç´ ãŒå­è¦ç´ ã‚ˆã‚Šå¸¸ã«å¤§ãã„(ã‚ã‚‹ã„ã¯å°ã•ã„)ã¨ã„ã†æ¡ä»¶ã‚’æº€ãŸã™ã‚‚ã®ã§ã™ã€‚

Python ã® heapq ã¯ æœ€å°å€¤ã‚’ã™ãã«å–ã‚Šå‡ºã›ã‚‹ãƒ‡ãƒ¼ã‚¿æ§‹é€ ï¼ˆæœ€å°ãƒ’ãƒ¼ãƒ—ï¼‰ã§ã™ã€‚
**kç•ªç›®ã«å¤§ãã„è¦ç´ **ã‚’æ±‚ã‚ãŸã„ã®ã§ã€å¸¸ã«å¤§ãã„è¦ç´ ã ã‘ãƒ’ãƒ¼ãƒ—ã«æ®‹ã™ã‚ˆã†ã«ã—ã¾ã™ã€‚
ãã†ã™ã‚‹ã¨ã€ãƒ’ãƒ¼ãƒ—ã®å…ˆé ­ï¼ˆæœ€å°å€¤ãŒï¼‰**kç•ªç›®ã«å¤§ãã„è¦ç´ **ã«ãªã‚Šã¾ã™ã€‚

ãƒªã‚¹ãƒˆã‚’ãã®éƒ½åº¦ã‚½ãƒ¼ãƒˆã—ãŸã‚ŠæŒ¿å…¥ä½ç½®ã‚’ãšã‚‰ã™ã‚ˆã‚Šã‚‚ã€ãƒ’ãƒ¼ãƒ—ãªã‚‰åŠ¹ç‡ã‚ˆãæ›´æ–°ã§ãã¾ã™ã€‚

### ã‚³ãƒ¼ãƒ‰
```py
class KthLargest:
    def __init__(self, k: int, nums: List[int]):
        self.k = k
        self.heap = nums
        heapq.heapify(self.heap)
        while len(self.heap) > k:
            heapq.heappop(self.heap)

    def add(self, val: int) -> int:
        if len(self.heap) < self.k:
            heapq.heappush(self.heap, val)
        elif val > self.heap[0]:
            heapq.heapreplace(self.heap, val)
        return self.heap[0]
```

åˆæœŸåŒ–ã§ã¯ã€ãƒ’ãƒ¼ãƒ—ã‚’ä½œæˆã—ã€kç•ªç›®ä»¥é™ã®è¦ç´ ã ã‘ã‚’æ®‹ã—ã¦ã„ã¾ã™ã€‚
addé–¢æ•°ã§ã¯ã€è¦ç´ æ•°ãŒkã‚ˆã‚Šå°‘ãªã‘ã‚Œã°è¿½åŠ ã€valãŒãƒ’ãƒ¼ãƒ—ã®æœ€å°å€¤ã‚ˆã‚Šã‚‚å¤§ãã‘ã‚Œã°`heapq.heapreplace`ã§å…¥ã‚Œæ›¿ãˆã‚’è¡Œãªã£ã¦ã„ã¾ã™ã€‚

### è¨ˆç®—é‡
- æ™‚é–“çš„è¨ˆç®—é‡ï¼šè¦ç´ è¿½åŠ ã”ã¨O(log k)
- ç©ºé–“çš„è¨ˆç®—é‡ï¼šO(k)
    - kå€‹ã®è¦ç´ ã ã‘ä¿æŒ